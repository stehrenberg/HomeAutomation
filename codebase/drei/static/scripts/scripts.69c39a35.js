"use strict";angular.module("DreiWebApp",["ngResource","ngRoute","ngDialog"]).constant("AppConfig",{serverAddress:"http://localhost:8080"}).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/users",{templateUrl:"views/users.html",controller:"UsersCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("DreiWebApp").controller("DashboardCtrl",["$scope","WebsocketService",function(a,b){a.$on("ActiveUsersNotification",function(b,c){a.activeUsers=c,a.lastUpdated=Date.now(),a.$digest()}),b.refreshActiveUsers()}]),angular.module("DreiWebApp").controller("UsersCtrl",["$scope","DataService","ngDialog",function(a,b,c){function d(){b.getUsers().then(function(b){a.users=b})}a.deleteUser=function(a){b.deleteUser(a).then(function(a){a?(d(),console.log("User removed")):console.log("ERROR: couldn't delete user")})},a.createUser=function(){var b=a.$new(!0);c.open({template:"views/dialogs/user.html",controller:"CreateUserCtrl",scope:b,preCloseCallback:function(a){a&&d()}})},a.updateUser=function(b){var e=a.$new(!0);e.user=angular.copy(b),c.open({template:"views/dialogs/user.html",controller:"UpdateUserCtrl",scope:e,preCloseCallback:function(a){a&&d()}})},d()}]),angular.module("DreiWebApp").controller("CreateUserCtrl",["$scope","DataService",function(a,b){a.cancel=function(){a.closeThisDialog(!1)},a.save=function(){if(a.userForm.$valid){var c=a.user;b.createUser(c).then(function(b){var c=b.created;a.closeThisDialog(c)})}}}]),angular.module("DreiWebApp").controller("UpdateUserCtrl",["$scope","DataService",function(a,b){a.cancel=function(){a.closeThisDialog(!1)},a.save=function(){if(a.userForm.$valid){var c=a.user;b.updateUser(c).then(function(b){var c=b.updated;a.closeThisDialog(c)})}}}]),angular.module("DreiWebApp").directive("isActiveNav",["$location",function(a){return{restrict:"A",link:function(b,c){b.location=a,b.$watch("location.path()",function(a){"/#"+a===c[0].attributes.href.nodeValue?c.parent().addClass("active"):c.parent().removeClass("active")})}}}]),function(){angular.module("DreiWebApp").service("DataService",["$resource","AppConfig",function(a,b){return{getUsers:function(){return a(b.serverAddress+"/api/users",{},{}).query().$promise.then(function(a){var b=[];return a.forEach(function(a){b.push({mac:a.mac,name:a.name,sound:a.sound,light_color:a.light_color})}),b})},createUser:function(c){return a(b.serverAddress+"/api/users",{},{post:{method:"POST"}}).post(c).$promise},deleteUser:function(c){return a(b.serverAddress+"/api/users/"+c.mac,{},{})["delete"]().$promise},updateUser:function(c){return a(b.serverAddress+"/api/users/"+escape(c.mac),{},{put:{method:"PUT"}}).put(c).$promise}}}])}(),function(){angular.module("DreiWebApp").service("WebsocketService",["$rootScope","AppConfig",function(a,b){function c(b){a.$broadcast("ActiveUsersNotification",JSON.parse(b))}function d(){e=io.connect(b.serverAddress),e.on("ActiveUsersNotification",c),e.on("connect",function(){e.emit("Connected")})}var e;return d(),{refreshActiveUsers:function(){e.emit("GetActiveUsersEvent")}}}])}();